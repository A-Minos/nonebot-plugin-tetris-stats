<!DOCTYPE html>

<html>
    <head>
        <meta charset="utf-8" />
        <title></title>
        <link href="./css/data-v2.css" rel="stylesheet" />
    </head>

    <body>
        <div class="main-content">
            <span class="account-title">Account&Rankings</span>
            <div class="user-info-box">
                <img class="user-avatar" src="https://tetr.io/user-content/avatars/{{user_id}}.jpg" />
                <div class="user-name">{{user_name}}</div>
                <div class="user-sgin">“{{user_sgin}}”</div>
            </div>
            <div class="game-info-box">
                <div class="game-type-box">
                    <img
                        class="game-logo"
                        src="./static/logo/{{game_name}}.svg"
                    />
                    <span class="game-name">{{game_name}}</span>
                </div>
                <div class="game-info-dividing-line"></div>
                <div class="ranking-info-box">
                    <span class="ranking-title">Ranking</span>
                    <span class="ranking">{{ranking}}</span>
                    <span class="rd">±{{rd}}</span>
                </div>
            </div>
            <div class="TR-curve-chart" id="TR-curve-chart">
                <span class="TR-title">Tetra Rating (TR)</span>
                <img class="rank-icon" src="./static/rank/{{rank}}.svg" />
                <span class="TR" style="display: flex; align-items: flex-end"
                    >{{TR}}&nbsp;
                    <p
                        style="
                            font-size: 30px;
                            font-weight: 400;
                            line-height: 47px;
                        "
                    >
                        (#{{global_rank}})
                    </p>
                </span>
            </div>
            <span class="multiplayer-title">Multiplayer Stats</span>
            <div class="lpm-table">
                <img src="./static/data/LPM.svg" />
                <span class="lpm-value">{{lpm}}</span>
                <span class="pps-value">{{pps}} pps</span>
            </div>
            <div class="apm-table">
                <img src="./static/data/APM.svg" />
                <span class="apm-value">{{apm}}</span>
                <span class="apl-value">x{{apl}}</span>
            </div>
            <div class="adpm-table">
                <img src="./static/data/ADPM.svg" />
                <span class="adpm-value">{{adpm}}</span>
                <span class="adpl-value">x{{adpl}}</span>
                <span class="vs-value">{{vs}} vs</span>
            </div>
            <div class="radar-map" id="radar-map"></div>
            <span class="singleplayer-title">Singleplayer Stats</span>
            <div class="sprint-table">
                <img src="./static/data/40L.svg" />
                <span class="sprint-value">{{sprint}}</span>
            </div>
            <div class="blitz-table">
                <img src="./static/data/Blitz.svg" />
                <span class="blitz-value">{{blitz}}</span>
            </div>
        </div>
    </body>

    <script src="./js/echarts.js"></script>

    <script>
        // 曲线图
        var lineChartDom = document.getElementById('TR-curve-chart');
        var lineChart = echarts.init(lineChartDom, null, { renderer: 'svg' });
        var option;

        /** @type EChartsOption */
        option = {
            grid: {
                left: '-5%',
                bottom: '17%',
                width: '90%',
                height: '70%',
            },

            xAxis: {
                type: 'time',
                minInterval: 3600 * 48 * 1000,
                axisTick: {
                    show: false,
                },
                axisLine: {
                    show: false,
                    lineStyle: {
                        color: '#FFFFFF',
                    },
                },
                axisLabel: {
                    fontFamily: 'CabinetGrotesk-Variable',
                    fontSize: 15,
                    align: 'center',
                    formatter: function (value, index) {
                        console.log(value, index);
                        var date = new Date(value);
                        var lst;
                        var ret;
                        function format_date() {
                            return new Intl.DateTimeFormat('en-US', {
                                month: '2-digit',
                                day: '2-digit',
                            })
                                .format(date)
                                .split('/');
                        }
                        switch (index) {
                            case 0:
                            case 6:
                                ret = '';
                                break;
                            default:
                                lst = format_date();
                                if (index === 5) {
                                    ret =
                                        '{last_month|' +
                                        lst[0] +
                                        '}\n{last_day|' +
                                        lst[1] +
                                        '}';
                                    break;
                                }
                                ret =
                                    '{month|' +
                                    lst[0] +
                                    '}\n{day|' +
                                    lst[1] +
                                    '}';
                        }
                        console.log(ret);
                        return ret;
                    },
                    rich: {
                        month: {
                            fontFamily: 'CabinetGrotesk-Variable',
                            fontSize: 13,
                            fontWeight: '400',
                            color: '#FFFFFF',
                            opacity: 0.6,
                        },
                        day: {
                            fontFamily: 'CabinetGrotesk-Variable',
                            fontSize: 20,
                            fontWeight: '800',
                            color: '#FFFFFF',
                            opacity: 0.6,
                        },
                        last_month: {
                            fontFamily: 'CabinetGrotesk-Variable',
                            fontSize: 13,
                            fontWeight: '400',
                            color: '#373533',
                            backgroundColor: '#FAFAFA',
                            borderRadius: 6,
                            padding: [-10, 0, 10, 0],
                            width: 36,
                            height: 37,
                            lineHeight: 32,
                        },
                        last_day: {
                            fontFamily: 'CabinetGrotesk-Variable',
                            fontSize: 20,
                            fontWeight: '800',
                            color: '#373533',
                            padding: [-18, 0, 0, 0],
                            lineHeight: 0,
                        },
                    },
                },
                zlevel: 1,
            },

            yAxis: {
                type: 'value',
                interval: {{split_value}},
                position: 'right',
                splitLine: {
                    show: false,
                },
                axisLine: {
                    show: false,
                    lineStyle: {
                        color: '#FFFFFF',
                    },
                },
                axisLabel: {
                    align: 'right',
                    formatter: function (value, index) {
                        return '{value|' + value.toLocaleString() + '}';
                    },
                    rich: {
                        value: {
                            fontFamily: 'CabinetGrotesk-Variable',
                            fontSize: 15,
                            fontWeight: '500',
                            color: '#FFFFFF',
                            opacity: 0.6,
                        },
                    },
                },
                offset: 70,
                max: {{value_max+offset}},
                min: {{value_min-offset}},
            },
            series: [
                {
                    // 10天的数据，最后一天只要第一条 (时间戳最少要多1ms)
                    data:{{data}},
                    type: 'line',
                    smooth: true,
                    symbol: function (value, params) {
                        console.log(value);
                        console.log(params);
                        // 模板化时传入 index
                        if (9 === params.dataIndex) {
                            return 'image://static/data/point.svg';
                        }
                        return 'none';
                    },
                    symbolSize: 75,
                    color: ['#FAFAFA99'],
                    markLine: {
                        data: [
                            {
                                xAxis: 'max',
                                y: 300,
                            },
                        ],
                        label: {
                            show: false,
                        },
                        lineStyle: {
                            color: '#FAFAFA',
                            width: 3,
                            type: 'dashed',
                            cap: 'round',
                            // dashOffset: 1,
                        },
                        symbol: 'none',
                        animation: false,
                    },
                    z: 5,
                },
            ],
        };
        option && lineChart.setOption(option);
    </script>

    <script>
        // 雷达图
        var radarChartDom = document.getElementById('radar-map');
        var radarChart = echarts.init(radarChartDom, null, { renderer: 'svg' });
        var option;

        option = {
            radar: [
                {
                    indicator: [
                        { text: 'SPM' },
                        { text: 'APM', nameRotate: 60 },
                        { text: 'ADPM', nameRotate: -60 },
                        { text: "D'PM" },
                        { text: 'DPM', nameRotate: 60 },
                        { text: "L'PM", nameRotate: -60 },
                    ],
                    center: ['50%', '50%'],
                    radius: '65%',
                    startAngle: 90,
                    splitNumber: 4,
                    shape: 'circle',
                    axisName: {
                        color: '#FAFAFA',
                    },
                    splitArea: {
                        show: false,
                    },
                    axisLine: {
                        lineStyle: {
                            color: 'rgba(250, 250, 250, 0.3)',
                        },
                    },
                    splitLine: {
                        lineStyle: {
                            color: 'rgba(250, 250, 250, 0.3)',
                        },
                    },
                },
            ],
            series: [
                {
                    type: 'radar',
                    label: {
                        show: true,
                    },
                    emphasis: {
                        disabled: true,
                    },
                    lineStyle: {
                        color: 'rgba(250, 250, 250, 1)',
                        shadowBlur: 12,
                        shadowColor: 'rgba(250, 250, 250, 1.5)',
                    },
                    areaStyle: {
                        color: 'rgba(250, 250, 250, 0.45)',
                    },
                    data: [
                        {
                            value: [{{spm}}, {{apm}}, {{adpm}}, {{dpm}}, {{dpm}}, {{lpm}}]
                        },
                    ],
                },
            ],
        };
        option && radarChart.setOption(option);
    </script>
</html>
